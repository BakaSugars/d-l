!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Dark",[],e):"object"==typeof exports?exports.Dark=e():t.Dark=e()}(window,function(){return function(t){var e={};function o(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=14)}([function(t,e,o){"use strict";(function(t){var i=void 0!==t&&t||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function n(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new n(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new n(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},o(15),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||void 0,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||void 0}).call(this,o(1))},function(t,e,o){"use strict";var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"===("undefined"==typeof window?"undefined":r(window))&&(i=window)}t.exports=i},function(t,e,o){t.exports=o.p+"41d5f748199d4ce284b62ffd0a060dec.jpg"},function(t,e,o){t.exports=o.p+"e6545fa56d001f00711e89d527f9195a.jpg"},function(t,e){t.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QEURXhpZgAATU0AKgAAAAgACwEaAAUAAAABAAAAkgEbAAUAAAABAAAAmgEoAAMAAAABAAIAAAExAAIAAAASAAAAogEyAAIAAAAUAAAAtAMBAAUAAAABAAAAyAMDAAEAAAABAAAAAFEQAAEAAAABAQAAAFERAAQAAAABAAALE1ESAAQAAAABAAALE4dpAAQAAAABAAAA0AAAAAAAARlIAAAD6AABGUgAAAPoUGFpbnQuTkVUIHYzLjUuMTAAMjAxMToxMDoxMyAwMjoxMTowOQAAAYagAACxjwABkoYABwAAACoAAADiAAAAAFVOSUNPREUAAEMAcgBlAGEAdABlAGQAIAB3AGkAdABoACAARwBJAE0AUP/bAEMABQQEBAQDBQQEBAYFBQYIDQgIBwcIEAsMCQ0TEBQTEhASEhQXHRkUFhwWEhIaIxocHh8hISEUGSQnJCAmHSAhIP/bAEMBBQYGCAcIDwgIDyAVEhUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIP/AABEIAgACAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK9A5wooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/2Q=="},function(t,e,o){t.exports=o.p+"88167b6407ffb8a522cee95e51932231.jpg"},function(t,e,o){t.exports=o.p+"9012972ad7d315f979c08adaabbeaa31.jpg"},function(t,e,o){t.exports=o.p+"3c8717c1fcc6928eef109d217217e944.jpg"},function(t,e){t.exports="#define FILL\nprecision {precision} float;\n\nattribute vec3 a_pos;\nattribute float a_infos;\nattribute vec4 a_color;\n\nuniform mat4 u_matrix_array[25];\nuniform int u_coord_id;\nvarying vec4 v_color;\n\nvoid main() {\n    float infos = float(a_infos);\n    float offsetY = mod(a_infos, 2.) - 0.5;\n    infos = (infos - mod(a_infos, 2.)) / 2.;\n    float offsetX = mod(infos, 2.) - 0.5;\n    float size = (infos - mod(infos, 2.)) / 2.;\n    vec2 offset = vec2(offsetX, offsetY) * size;\n    vec3 pos = a_pos + vec3(offset, 0);\n    \n    // float color = float(a_color);\n    // float a = mod(color, 256.) / 255.;\n    // color = (color - a) / 256.;\n    // float b = mod(color, 256.) / 255.;\n    // color = (color - a) / 256.;\n    // float g = mod(color, 256.) / 255.;\n    // float r = color = (color - a) / 256.;\n\n    v_color = a_color / 255.;\n\n    // posProcess\n    gl_Position = u_matrix_array[u_coord_id] * vec4(pos, 1);\n}\n"},function(t,e){t.exports="#define FILL\nprecision {precision} float;\n\nvarying vec4 v_color;\n\nvoid main() {\n    vec4 color = v_color;\n\n    gl_FragColor = color;\n}"},function(t,e){t.exports="#define FILL\nprecision {precision} float;\n\nattribute vec3 a_pos;\nattribute float a_infos;\nattribute vec4 a_color;\n\nuniform mat4 u_matrix_array[25];\nuniform int u_coord_id;\nvarying vec4 v_color;\n\nvoid main() {\n    float infos = float(a_infos);\n    float offsetY = mod(a_infos, 2.) - 0.5;\n    infos = (infos - mod(a_infos, 2.)) / 2.;\n    float offsetX = mod(infos, 2.) - 0.5;\n    float size = (infos - mod(infos, 2.)) / 2.;\n    vec2 offset = vec2(offsetX, offsetY) * size;\n    vec3 pos = a_pos + vec3(offset, 0);\n    \n    // float color = float(a_color);\n    // float a = mod(color, 256.) / 255.;\n    // color = (color - a) / 256.;\n    // float b = mod(color, 256.) / 255.;\n    // color = (color - a) / 256.;\n    // float g = mod(color, 256.) / 255.;\n    // float r = color = (color - a) / 256.;\n\n    v_color = a_color / 255.;\n\n    // posProcess\n    gl_Position = u_matrix_array[u_coord_id] * vec4(pos, 1);\n}\n"},function(t,e){t.exports="#define FILL\nprecision {precision} float;\n\nvarying vec4 v_color;\n\nvoid main() {\n    vec4 color = v_color;\n\n    gl_FragColor = color;\n}"},function(t,e){t.exports="#define FILL\nprecision {precision} float;\n\nattribute vec2 a_pos;\n\nuniform mat4 u_matrix_array[25];\nuniform int u_coord_id;\n\nvarying vec4 v_pos;\n\nvoid main() {\n    vec4 pos = vec4(a_pos, 1., 1.);\n    v_pos = pos;\n\n    gl_Position = pos;\n}\n"},function(t,e){t.exports="#define FILL\nprecision {precision} float;\n\nuniform samplerCube u_sky_cube;\nuniform vec4 u_color;\nuniform mat4 u_matrix_array[25];\n// uniform int u_coord_id;\n\nvarying vec4 v_pos;\n\nvoid main() {\n    vec4 texture_loc = u_matrix_array[24] * v_pos;\n    gl_FragColor = textureCube(u_sky_cube, texture_loc.xyz / texture_loc.w);\n}"},function(t,e,o){t.exports=o(17)},function(t,e,o){"use strict";(function(t,e){!function(t,o){if(!t.setImmediate){var i,r,n,s,a,u=1,c={},f=!1,h=t.document,A=Object.getPrototypeOf&&Object.getPrototypeOf(t);A=A&&A.setTimeout?A:t,"[object process]"==={}.toString.call(t.process)?i=function(t){e.nextTick(function(){_(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,o=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=o,e}}()?t.MessageChannel?((n=new MessageChannel).port1.onmessage=function(t){_(t.data)},i=function(t){n.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(r=h.documentElement,i=function(t){var e=h.createElement("script");e.onreadystatechange=function(){_(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):i=function(t){setTimeout(_,0,t)}:(s="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&_(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),i=function(e){t.postMessage(s+e,"*")}),A.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),o=0;o<e.length;o++)e[o]=arguments[o+1];var r={callback:t,args:e};return c[u]=r,i(u),u++},A.clearImmediate=l}function l(t){delete c[t]}function _(t){if(f)setTimeout(_,0,t);else{var e=c[t];if(e){f=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(o,i)}}(e)}finally{l(t),f=!1}}}}}("undefined"==typeof self?void 0===t?void 0:t:self)}).call(this,o(1),o(16))},function(t,e,o){"use strict";var i,r,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,f=[],h=!1,A=-1;function l(){h&&c&&(h=!1,c.length?f=c.concat(f):A=-1,f.length&&_())}function _(){if(!h){var t=u(l);h=!0;for(var e=f.length;e;){for(c=f,f=[];++A<e;)c&&c[A].run();A=-1,e=f.length}c=null,h=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function K(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)e[o-1]=arguments[o];f.push(new p(t,e)),1!==f.length||h||u(_)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=K,n.addListener=K,n.once=K,n.off=K,n.removeListener=K,n.removeAllListeners=K,n.emit=K,n.prependListener=K,n.prependOnceListener=K,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,o){"use strict";o.r(e);var i=function(){function t(t,e,o){this._x=t,this._y=e,this._z=o}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},enumerable:!0,configurable:!0}),t.prototype.add=function(t){return this._x+=t.x,this._y+=t.y,this._z+=t.z,this},t.prototype.sub=function(t){return this._x-=t.x,this._y-=t.y,this._z-=t.z,this},t.prototype.unit=function(){return 0===this.mag()?this:(this.div(this.mag()),this)},t.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.mult=function(t){return this._x*=t,this._y*=t,this._z*=t,this},t.prototype.multVector=function(t){return t.x*this._x+t.y*this._y+t.z*this._z},t.prototype.div=function(t){return this._x/=t,this._y/=t,this._z/=t,this},t.prototype.clone=function(){return new t(this._x,this._y,this._z)},t.prototype.toArray=function(){return[this.x,this.y]},t.prototype.reverse=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this},t.prototype.rotate=function(t){var e=this._x,o=this._y;return this._x=e*Math.cos(t)-o*Math.sin(t),this._y=e*Math.sin(t)+o*Math.cos(t),this},t}(),r=!1,n=function(){function t(){this._destroyed=!1}return Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInEventTime",{get:function(){return r},set:function(t){r=t},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e){return this._listeners=this._listeners||{},this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this},t.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},this._oneTimeListeners[t]=this._oneTimeListeners[t]||[],this._oneTimeListeners[t].push(e),this},t.prototype.off=function(t,e){return this._removeEventListener(t,e,this._listeners),this._removeEventListener(t,e,this._oneTimeListeners),this},t.prototype.emit=function(t){if(this._listeners&&this._listeners[t.type]&&this._listeners[t.type].length>0)for(var e=0,o=this._listeners[t.type].slice();e<o.length;e++){(n=o[e]).call(this,t)}if(this._oneTimeListeners&&this._oneTimeListeners[t.type]&&this._oneTimeListeners[t.type].length>0)for(var i=0,r=this._oneTimeListeners[t.type].slice();i<r.length;i++){var n=r[i];this.off(t.type,n),n.call(this,t)}return this._parent&&this._parent.emit(t),this},t.prototype.setParent=function(t){this._parent=t},t.prototype.destroy=function(){this._listeners={},this._oneTimeListeners={},this._parent=null,this._destroyed=!0},t.prototype._removeEventListener=function(t,e,o){if(o&&o[t]){var i=o[t].indexOf(e);-1!==i&&o[t].splice(i,1)}},t}(),s=function(){function t(t){this._value=t}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"before",{get:function(){return this._before.value},set:function(e){new t(e).nextLink=this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next.value},set:function(e){new t(e).beforeLink=this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeLink",{get:function(){return this._before},set:function(t){this._before=t,t&&t.nextLink!==this&&(t.nextLink=this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextLink",{get:function(){return this._next},set:function(t){this._next=t,t&&t.nextLink!==this&&(t.beforeLink=this)},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._before&&(this._before.nextLink=this._next),this._next&&(this._next.beforeLink=this._before),this._value=null,this._before=void 0,this._next=void 0},t}(),a=o(0);var u=0;var c={},f={};function h(t){Object.keys(c).forEach(function(e){t===c[e]&&(c[e]=t.beforeLink||t.nextLink,c[e]||Object(a.clearTimeout)(f[e]))}),t.destroy()}var A,l,_=1e7,p=function(){function t(t,e){void 0===e&&(e={}),this._type=t,this._data=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t}(),K=(A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});!function(t){t.Destroy="del",t.Happen="hal"}(l||(l={}));var y,g=function(t){function e(){return t.call(this)||this}return K(e,t),Object.defineProperty(e.prototype,"from",{get:function(){return this._from},set:function(t){this._from=t},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.emit(new p(l.Destroy,this)),this._from=null,t.prototype.destroy.call(this)},e}(n),d=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),m=function(t){function e(e,o){var i=t.call(this)||this;return i._leftTop=e,i._rightBottom=o,i}return d(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this.lt.clone().add(this.rb).div(2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.rb.x-this.lt.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.rb.y-this.lt.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lt",{get:function(){return this._leftTop},set:function(t){this._leftTop=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rb",{get:function(){return this._rightBottom},set:function(t){this._rightBottom=t},enumerable:!0,configurable:!0}),e.prototype.intersect=function(t){return t instanceof e&&this._intersectBox(t)},e.prototype._intersectBox=function(t){var e=Math.abs(t.center.x-this.center.x),o=Math.abs(t.center.y-this.center.y),i=(this.width+t.width)/2,r=(this.height+t.height)/2;return e<=i&&o<=r},e}(g),b=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),v=function(t){function e(e){var o=t.call(this)||this;o._speed=new i(0,0,0),o._direction=new i(1,0,0),o._color=[0,0,0,255],o._size=1,o._lifePoint=_;var r=e.loc,n=e.speed,s=e.color,a=e.size,c=void 0===a?o._size:a,f=e.lifePoint;return o._loc=r,o._speed=n||o._speed,o._color=s||o._color,o._size=c||o._size,o._lifePoint=f||o._lifePoint,o._lastUpdateTime=Date.now(),o._id=u++,o._regCollsion(),o}return b(e,t),e.prototype.update=function(){},Object.defineProperty(e.prototype,"collsionType",{get:function(){return this._collsionUnitType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collsionUnit",{get:function(){return this._collsionUnit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loc",{get:function(){return this._loc},set:function(t){this._loc=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastUpdateTime",{get:function(){return this._lastUpdateTime},enumerable:!0,configurable:!0}),e.prototype.updateLocation=function(){var t=Date.now(),e=t-this._lastUpdateTime;this._lastUpdateTime=t;var o=this._speed.clone().mult(e);this._loc=this._loc.add(o),this._collsionUnit&&this.updateCollsionUnit()},e.prototype.updateCollsionUnit=function(){var t=this._getCollsionPoint();this._collsionUnit.lt=this._loc.clone().sub(t),this._collsionUnit.rb=this._loc.clone().add(t)},e.prototype.destroy=function(){this._collsionUnit.destroy(),t.prototype.destroy.call(this)},e.prototype._getCollsionPoint=function(){var t=this._size/2;return new i(t,t,0)},e.prototype._regCollsion=function(){var t=this._getCollsionPoint();this._collsionUnit=new m(this._loc.clone().sub(t),this._loc.clone().add(t)),this._collsionUnit.from=this},e}(n),x=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();!function(t){t[t.Bullet=0]="Bullet",t[t.Shooter=1]="Shooter",t[t.Grid=2]="Grid",t[t.Border=3]="Border"}(y||(y={}));var C,w=function(t){function e(){return t.call(this)||this}return x(e,t),e.prototype.clear=function(){this._collsionMap={}},e.prototype.addCollsionUnit=function(t,e){var o=this,i=e.collisionTypes,r=new s(t),n=t.from.collsionType;this._collsionMap[n]&&(this._collsionMap[n].nextLink=r),this._collsionMap[n]=r;var a,u=!1;t.on(l.Destroy,a=function(){u=!0,r.destroy()}),i.forEach(function(e){for(var i=o._collsionMap[e];i;){if(u)return;if(!i.value)return;if(i.value.destroyed)return;i.value.intersect(t)&&(i.value.emit(new p(l.Happen,t)),t.emit(new p(l.Happen,i.value))),i=i.beforeLink}}),u||t.off(l.Destroy,a)},e}(n),E=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),O="del",P=function(t){function e(e){var o=t.call(this,e)||this;return o._lifeTime=5e3,o._collsionUnitType=y.Bullet,o._baseDamage=2,o.direction=o.speed.clone().unit(),o._baseDamage=e.damage||o._baseDamage,o._lifeEndTimeout=setTimeout(function(){o.destroy()},o._lifeTime),o._registEvent(),o}return E(e,t),e.prototype.getDamage=function(t){var e=this.speed.mag(),o=e+this.speed.clone().unit().multVector(t.speed);return o<=0?0:0===this.speed.mag()?0:(o=o>e?1.51*e:.67*e,Math.max(Math.round(o/e*this._baseDamage),1))},Object.defineProperty(e.prototype,"owner",{get:function(){return this._owner},set:function(t){this._owner=t},enumerable:!0,configurable:!0}),e.prototype.addCollsionBullet=function(t){t.addCollsionUnit(this._collsionUnit,{collisionTypes:[y.Shooter,y.Border]})},e.prototype.destroy=function(){clearTimeout(this._lifeEndTimeout),this._owner=null,this.emit(new p(O,this)),t.prototype.destroy.call(this)},e.prototype._registEvent=function(){var t=this;this._collsionUnit.on(l.Happen,function(e){e.data.from.collsionType===y.Border&&t._borderCollsion()})},e.prototype._borderCollsion=function(){this.destroy()},e}(v),T=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),B=function(t){function e(){var e=t.call(this)||this;return e._bulletNum=0,e}return T(e,t),e.prototype.addBullet=function(t){var e=this;this._bulletNum++;var o=new P(t),i=new s(o);return this._bulletLink&&(i.beforeLink=this._bulletLink),this._bulletLink=i,o.once(O,function(){e._bulletLink===i&&(e._bulletLink=i.nextLink||i.beforeLink),i.destroy(),e._bulletNum--}),o},e.prototype.addCollsionUnit=function(t){this.forEach(function(e){e.addCollsionBullet(t)})},Object.defineProperty(e.prototype,"bulletNum",{get:function(){return this._bulletNum},enumerable:!0,configurable:!0}),e.prototype.forEach=function(t){if(this._bulletLink)for(var e=this._bulletLink;e;)t(e.value),e=e.beforeLink},e.prototype.destroy=function(){this.forEach(function(t){t.destroy()}),t.prototype.destroy.call(this)},e.prototype.update=function(){this.forEach(function(t){t.updateLocation()})},e}(n),M=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),L=function(t){function e(e){var o=t.call(this,e)||this;o._defaultDecSpeed=.04,o._maxFirePerSec=3,o._minFireTime=1e3/3,o._lastFireTime=0,o._bulletSpeed=.3,o._bulletManager=new B,o._bulletColor=[255,153,17,255],o._bulletSize=6,o._collsionUnitType=y.Shooter;var i=e.uid;e.camp;return o._uid=i,o.size=10,o._camp=e.camp,o._bulletManager.setParent(o),o._registEvent(),o}return M(e,t),Object.defineProperty(e.prototype,"bulletSize",{set:function(t){this._bulletSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bulletColor",{set:function(t){this._bulletColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bulletSpeed",{set:function(t){this._bulletSpeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxFirePerSec",{set:function(t){this._maxFirePerSec=t,this._minFireTime=1e3/t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camp",{get:function(){return this._camp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bulletManager",{get:function(){return this._bulletManager},enumerable:!0,configurable:!0}),e.prototype.addCollsionUnit=function(t){t.addCollsionUnit(this._collsionUnit,{collisionTypes:[y.Border,y.Bullet]}),this._bulletManager.addCollsionUnit(t)},e.prototype.update=function(){this._lastLoc=this.loc.clone(),this.updateLocation(),0!==this.speed.mag()&&this.speed.sub(this.speed.clone().mult(this._defaultDecSpeed)),this._bulletManager.update()},e.prototype.startFire=function(){var t=this,e=Date.now();return!(e-this._lastFireTime<this._minFireTime)&&(this._setIntervalFire&&h(this._setIntervalFire),this._lastFireTime=e,this.fire(),this._setIntervalFire=function(t,e){e=Math.floor(e);var o=new s(t);return c[e]?(o.beforeLink=c[e],c[e]=o,o):(c[e]=o,f[e]=Object(a.setInterval)(function(){for(var t=c[e];t;)t.value(),0,t=t.beforeLink},e),o)}(function(){t.fire()},this._minFireTime),!0)},e.prototype.endFire=function(){this._setIntervalFire&&h(this._setIntervalFire)},e.prototype.destroy=function(){this._collsionUnit.destroy(),this._bulletManager.destroy(),t.prototype.destroy.call(this)},e.prototype.fire=function(){this.direction.clone().mult(this._bulletSpeed),this.direction.clone().mult(this.direction.multVector(this.speed));this._bulletManager.addBullet({loc:this.loc.clone(),speed:this.direction.clone().mult(this._bulletSpeed).add(this.speed),color:this._bulletColor,size:this._bulletSize}).owner=this},e.prototype._judgeEnemyBullet=function(t){var e=t.from.owner.camp;return this._camp!==e},e.prototype._registEvent=function(){var t=this;this._collsionUnit.on(l.Happen,function(e){var o=e.data,i=o.from.collsionType;i===y.Border?t._borderCollision():i===y.Bullet&&t._bulletCollsion(o)})},e.prototype._bulletCollsion=function(t){if(this._judgeEnemyBullet(t)){var e=t.from;this.speed.add(e.speed.mult(e.size/this.size)),this._getBulletDamage(e)}},e.prototype._getBulletDamage=function(t){var e=t.getDamage(this);console.log("cause damage",e),0!==e&&(this._getDamage(e),t.destroy())},e.prototype._getDamage=function(t){var e=this;this._lifePoint-=t,console.log(this.id,"left life point",this._lifePoint),this._lifePoint<=0?this.destroy():(this._originColor||(this._originColor=this.color),this.color=[255,0,0,255],setTimeout(function(){e.color=e._originColor},1e3))},e.prototype._borderCollision=function(){this.loc=this._lastLoc,this.speed=new i(0,0,0)},e}(v),U=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();!function(t){t.MOVE="mousemove",t.DOWN="mousedown",t.UP="mouseup",t.LEFTUP="mouseup",t.LEFTDOWN="leftdown",t.RIGHTDOWN="rightdown",t.RIGHTUP="rightup"}(C||(C={}));var V,S=function(t){function e(e,o,r,n){var s=t.call(this,e)||this;s._el=r,s._originEvent=o;var a=new i(o.clientX,o.clientY,0),u=n.pixelToCoordinate(a);return s._coordinate=u,s}return U(e,t),Object.defineProperty(e.prototype,"mousePos",{get:function(){var t,e,o;return this._mousePos||(this._mousePos=(t=this._el,e=this._originEvent,o=this._el.getBoundingClientRect(),e=e.touches?e.touches[0]:e,new i(e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop,0))),this._mousePos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coord",{get:function(){return this._coordinate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originEvent",{get:function(){return this._originEvent},enumerable:!0,configurable:!0}),e}(p),j=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),I={MOVE:"mousemove",DOWN:"mousedown",UP:"mouseup",LEFTUP:"mouseup",LEFTDOWN:"leftdown",RIGHTDOWN:"rightdown",RIGHTUP:"rightup"};!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(V||(V={}));var F=function(t){function e(e,o){var i=t.call(this)||this;return i._element=e,console.log(i._element),i._camera=o,i._element.oncontextmenu=function(t){t.preventDefault()},document.addEventListener(I.MOVE,i._onMouseMove.bind(i)),i._element.addEventListener(I.DOWN,i._onMouseDown.bind(i)),i._element.addEventListener(I.UP,i._onMouseUp.bind(i)),i}return j(e,t),e.prototype.init=function(t){this._camera=t},e.prototype._onMouseMove=function(t){this.emit(new S(I.MOVE,t,this._element,this._camera))},e.prototype._onMouseDown=function(t){this.emit(new S(I.DOWN,t,this._element,this._camera)),t.button===V.Left?this._leftDown(t):t.button===V.Right&&this._rightDown(t)},e.prototype._onMouseUp=function(t){this.emit(new S(I.UP,t,this._element,this._camera)),t.button===V.Left?this._leftUp(t):t.button===V.Right&&this._rightUp(t)},e.prototype._leftDown=function(t){this.emit(new S(I.LEFTDOWN,t,this._element,this._camera))},e.prototype._leftUp=function(t){this.emit(new S(I.LEFTUP,t,this._element,this._camera))},e.prototype._rightDown=function(t){this.emit(new S(I.RIGHTDOWN,t,this._element,this._camera))},e.prototype._rightUp=function(t){this.emit(new S(I.RIGHTUP,t,this._element,this._camera))},e}(n),D=function(){function t(t){var e=t.secret,o=t.id,i=t.camera,r=t.keyboard,n=t.mouse,s=t.uiElement;this._keyboard=r,this._mouse=n,this._uiElement=s,this._secret=e,this._id=o,this._camera=i,this._bindKeyboard(),this._bindMouse(),this._bindUIElement()}return Object.defineProperty(t.prototype,"loc",{get:function(){return this._shooter.loc},set:function(t){this._shooter.loc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shooter",{get:function(){return this._shooter},enumerable:!0,configurable:!0}),t.prototype.fitCamera=function(){this._camera.setLoc(this._shooter.loc)},t.prototype.createShooter=function(t){return this._shooter=new L({loc:t,uid:this._id,camp:0}),this._shooter},t.prototype._bindMouse=function(){var t=this;if(!this._mouse)return!1;this._bindMouseDown(),this._mouse.on(I.MOVE,function(e){var o=e.coord.sub(t._shooter.loc);t._shooter.direction=o.unit()})},t.prototype._bindMouseDown=function(){this._bindLeft(),this._bindRight()},t.prototype._bindLeft=function(){var t=this;this._mouse.once(I.LEFTDOWN,function(){t._shooter.startFire(),t._mouse.once(I.LEFTUP,function(){t._shooter.endFire(),t._bindLeft()})})},t.prototype._bindRight=function(){var t=this;this._mouse.once(I.RIGHTDOWN,function(e){var o,i=e.mousePos;console.log(i),t._mouse.on(I.MOVE,o=function(e){var o=e.mousePos,r=o.clone().sub(i),n=.01*r.x,s=.01*r.y;t._camera.setAngle(t._camera.angle-n),t._camera.setPitch(t._camera.pitch+s),i=o}),t._mouse.once(I.RIGHTUP,function(){t._mouse.off(I.MOVE,o),t._bindRight()})})},t.prototype._bindKeyboard=function(){var t=this;if(!this._keyboard)return!1;this._keyboard.on("change_speed",function(e){var o=e.data,i=t._camera.angle;t.shooter.speed.add(o.rotate(-i))})},t.prototype._bindUIElement=function(){var t=this;if(!this._uiElement)return!1;this._uiElement.on("change_speed",function(e){console.log("e",e);var o=e.data,i=t._camera.angle;t.shooter.speed.add(o.rotate(-i))})},t}(),R=function(){},k=function(){function t(t,e,o){this._padding=1,this._loc=t,this._width=e,this._color=o}return Object.defineProperty(t.prototype,"loc",{get:function(){return this._loc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return new i(this._loc.x*this._width+this._width/2,this._loc.y*this._width+this._width/2,this._loc.z)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"padding",{get:function(){return this._padding},enumerable:!0,configurable:!0}),t}();var N=function(){function t(t,e,o,i,r,n){void 0===n&&(n=!0),this.isStatic=!0,this._type=o,this._arrayBuffer=e,this._elementBytes=i,this._attributes=r,this.gl=t,this.isStatic=n}return Object.defineProperty(t.prototype,"elementBytes",{get:function(){return this._elementBytes},set:function(t){this._elementBytes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){return this._attributes},set:function(t){this._attributes=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"arrayBuffer",{get:function(){return this._arrayBuffer},set:function(t){this._arrayBuffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var t=0;return this._arrayBuffer&&(t+=this._arrayBuffer.byteLength/1024/1024),t},enumerable:!0,configurable:!0}),t.prototype.bind=function(){this._buffer?this.gl.bindBuffer(this.gl[this._type],this._buffer):(this._buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl[this._type],this._buffer),this.gl.bufferData(this.gl[this._type],this._arrayBuffer,this.isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW))},t.prototype.updateData=function(t){this._arrayBuffer=t,this._buffer?(this.gl.bindBuffer(this.gl[this._type],this._buffer),this._arrayBuffer&&this._arrayBuffer.byteLength>=t.byteLength?this.gl.bufferSubData(this.gl[this._type],0,t):this.gl.bufferData(this.gl[this._type],t,this.isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW)):(this._buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl[this._type],this._buffer),this.gl.bufferData(this.gl[this._type],t,this.isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW))},t.prototype.destroy=function(){this._buffer&&(this.gl.deleteBuffer(this._buffer),this._buffer=null)},t}(),z=function(){function t(t){this._renderer=t,this._gl=this._renderer.gl}return Object.defineProperty(t.prototype,"loadPromise",{get:function(){return this._loadPromise},set:function(t){this._loadPromise=t},enumerable:!0,configurable:!0}),t.prototype.draw=function(t){if(this._renderer.useProgram(this._program),this.update(),!this._vertexArray||this._vertexArray.byteLength){t&&this._program.bindNoCachedMatrix(this._gl,new Float32Array(t));for(var e=this._createGLBufferGroup(),o=0,i=this._segments;o<i.length;o++){var r=i[o];this._program.bindVAO(this._gl,e,r),this._program.draw(this._gl,r)}}},Object.defineProperty(t.prototype,"uint32VertexArray",{get:function(){return this._uint32VertexArray||(this._uint32VertexArray=new Uint32Array(this._vertexArray)),this._uint32VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uint16VertexArray",{get:function(){return this._uint16VertexArray||(this._uint16VertexArray=new Uint16Array(this._vertexArray)),this._uint16VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uint8VertexArray",{get:function(){return this._uint8VertexArray||(this._uint8VertexArray=new Uint8Array(this._vertexArray)),this._uint8VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"int32VertexArray",{get:function(){return this._int32VertexArray||(this._int32VertexArray=new Int32Array(this._vertexArray)),this._int32VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"int16VertexArray",{get:function(){return this._int16VertexArray||(this._int16VertexArray=new Int16Array(this._vertexArray)),this._int16VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"int8VertexArray",{get:function(){return this._int8VertexArray||(this._int8VertexArray=new Int8Array(this._vertexArray)),this._int8VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"float32VertexArray",{get:function(){return this._float32VertexArray||(this._float32VertexArray=new Float32Array(this._vertexArray)),this._float32VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"float64VertexArray",{get:function(){return this._float64VertexArray||(this._float64VertexArray=new Float64Array(this._vertexArray)),this._float64VertexArray},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexArray",{set:function(t){this._vertexArray=t,this._uint32VertexArray=null,this._uint16VertexArray=null,this._uint8VertexArray=null,this._int32VertexArray=null,this._int16VertexArray=null,this._int8VertexArray=null,this._float32VertexArray=null,this._float64VertexArray=null},enumerable:!0,configurable:!0}),t.prototype._createSegment=function(){return{primitiveLength:0,primitiveOffset:0,vertexLength:0,vertexOffset:0}},t.prototype._initProgram=function(){if(this._renderer.createProgram(this._programType),this._program=this._renderer.getCachedProgram(this._programType),!this._program)throw new Error("no "+this._programType+" program")},t}(),G=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Q=function(t){function e(e){var o=t.call(this,e)||this;return o._shooters=[],o._vertexBufferByteSize=20,o._programType="circle",o._initProgram(),o}return G(e,t),Object.defineProperty(e.prototype,"shooters",{get:function(){return this._shooters},enumerable:!0,configurable:!0}),e.prototype.addShooter=function(t){this._shooters.push(t)},e.prototype.update=function(){var t=this,e=this._createSegment(),o=this._shooters.length+1;this.vertexArray=new ArrayBuffer(this._vertexBufferByteSize*o*4),this._elementArray=new Uint16Array(6*o),this._shooters.forEach(function(e,o){e.destroyed||t._resolveShooter(e,o)}),e.vertexLength=4*o,e.primitiveLength=2*o,this._segments=[e]},e.prototype._createGLBufferGroup=function(){var t=[];return t.push({name:"a_pos",type:"FLOAT",components:3,offset:0}),t.push({name:"a_infos",type:"FLOAT",components:1,offset:12}),t.push({name:"a_color",type:"UNSIGNED_BYTE",components:4,offset:16}),{vertexLayoutArrayBuffer:new N(this._gl,this._vertexArray,"ARRAY_BUFFER",20,t),elementArrayBuffer:new N(this._gl,this._elementArray.buffer,"ELEMENT_ARRAY_BUFFER",6,[{components:3,name:"vertices",offset:0,type:"UNSIGNED_SHORT"}]),paintVertexArrayBuffer:null,segments:this._segments}},e.prototype._resolveShooter=function(t,e){var o=e;e*=4,this._resolveVeretx(t,e,0,1),this._resolveVeretx(t,e+1,1,1),this._resolveVeretx(t,e+2,1,0),this._resolveVeretx(t,e+3,0,0);var i=6*o;this._elementArray[i++]=e,this._elementArray[i++]=e+1,this._elementArray[i++]=e+2,this._elementArray[i++]=e,this._elementArray[i++]=e+2,this._elementArray[i++]=e+3},e.prototype._resolveVeretx=function(t,e,o,i){var r=e*this._vertexBufferByteSize/4,n=e*this._vertexBufferByteSize,s=t.loc.x,a=t.loc.y,u=t.loc.z,c=t.color,f=t.size;this.float32VertexArray[r]=s,this.float32VertexArray[r+1]=a,this.float32VertexArray[r+2]=u;var h=2*(2*f+o)+i;this.float32VertexArray[r+3]=h,this.uint8VertexArray[n+16]=c[0],this.uint8VertexArray[n+17]=c[1],this.uint8VertexArray[n+18]=c[2],this.uint8VertexArray[n+19]=c[3]},e}(z),W=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),H=function(t){function e(e){var o=t.call(this,e)||this;return o._height=e.height,o._width=e.width,o}return W(e,t),e.prototype._getCollsionPoint=function(){var t=this._width/2,e=this._height/2;return new i(t,e,0)},e}(v),Y=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),X=function(t){function e(e){var o=t.call(this,e)||this;return o._collsionUnitType=y.Border,o.updateLocation(),o}return Y(e,t),Object.defineProperty(e.prototype,"collisionUnit",{get:function(){return this._collsionUnit},enumerable:!0,configurable:!0}),e}(H),Z=1e5,q=function(){function t(t,e,o){this._borderWidth=Z,this._borders=[],this._width=t*o,this._height=e*o,this._gridSize=o,this.initBorders()}return t.prototype._getCollsionPoint=function(){var t=this._width/2,e=this._height/2;return new i(t,e,0)},t.prototype.addCollsionUnit=function(t){this._borders.forEach(function(e){t.addCollsionUnit(e.collisionUnit,{collisionTypes:[y.Bullet,y.Shooter]})})},t.prototype.inBorder=function(t){return!(t.x<-this._width/2||t.x>this._width/2)&&(!(t.y<-this._height/2||t.y>this._height/2)&&void 0)},t.prototype.initBorders=function(){var t=this._borderWidth/2;this._topBorder=new X({loc:new i(0,-this._height/2-t,0),height:this._borderWidth,width:this._width}),this._borders.push(this._topBorder),this._rightBorder=new X({loc:new i(this._width/2+t,0,0),height:this._height,width:this._borderWidth}),this._borders.push(this._rightBorder),this._leftBorder=new X({loc:new i(-this._width/2-t,0,0),height:this._height,width:this._borderWidth}),this._borders.push(this._leftBorder),this._bottomBorder=new X({loc:new i(0,this._height/2+t,0),height:this._borderWidth,width:this._width}),this._borders.push(this._bottomBorder)},t}(),J=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),$=function(t){function e(e){var o=t.call(this,e)||this;return o._grids=[],o._programType="triangle",o._vertexBufferByteSize=20,o._initProgram(),o}return J(e,t),e.prototype.addGrid=function(t){this._grids.push(t)},e.prototype.getGrid=function(t){return this._grids[t]},e.prototype.update=function(){var t=this,e=this._createSegment();this.vertexArray=new ArrayBuffer(this._vertexBufferByteSize*this._grids.length*4),this._elementArray=new Uint16Array(6*this._grids.length),this._grids.forEach(function(e,o){t._resolveGrid(e,o)}),e.vertexLength=4*this._grids.length,e.primitiveLength=2*this._grids.length,this._segments=[e]},e.prototype._createGLBufferGroup=function(){var t=[];return t.push({name:"a_pos",type:"FLOAT",components:3,offset:0}),t.push({name:"a_infos",type:"FLOAT",components:1,offset:12}),t.push({name:"a_color",type:"UNSIGNED_BYTE",components:4,offset:16}),{vertexLayoutArrayBuffer:new N(this._gl,this._vertexArray,"ARRAY_BUFFER",20,t),elementArrayBuffer:new N(this._gl,this._elementArray.buffer,"ELEMENT_ARRAY_BUFFER",6,[{components:3,name:"vertices",offset:0,type:"UNSIGNED_SHORT"}]),paintVertexArrayBuffer:null,segments:this._segments}},e.prototype._resolveGrid=function(t,e){var o=e;e*=4,this._resolveVeretx(t,e,0,1),this._resolveVeretx(t,e+1,1,1),this._resolveVeretx(t,e+2,1,0),this._resolveVeretx(t,e+3,0,0);var i=6*o;this._elementArray[i++]=e,this._elementArray[i++]=e+1,this._elementArray[i++]=e+2,this._elementArray[i++]=e,this._elementArray[i++]=e+2,this._elementArray[i++]=e+3},e.prototype._resolveVeretx=function(t,e,o,i){var r=e*this._vertexBufferByteSize/4,n=e*this._vertexBufferByteSize,s=t.center.x,a=t.center.y,u=t.center.z,c=t.color,f=t.width-2*t.padding;this.float32VertexArray[r]=s,this.float32VertexArray[r+1]=a,this.float32VertexArray[r+2]=u;var h=2*(2*f+o)+i;this.float32VertexArray[r+3]=h,this.uint8VertexArray[n+16]=c[0],this.uint8VertexArray[n+17]=c[1],this.uint8VertexArray[n+18]=c[2],this.uint8VertexArray[n+19]=c[3]},e}(z),tt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tt(e,t),e}(i),ot=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),it=function(t){function e(e){var o=t.call(this,e)||this;return o._bulletManagers=[],o._vertexBufferByteSize=20,o._programType="triangle",o._initProgram(),o}return ot(e,t),e.prototype.addBulletManager=function(t){this._bulletManagers.push(t.bulletManager)},e.prototype.update=function(){var t=this,e=this._createSegment(),o=0;this._bulletManagers.forEach(function(t){o+=t.bulletNum}),this.vertexArray=new ArrayBuffer(4*o*this._vertexBufferByteSize),this._elementArray=new Uint16Array(6*o);var i=0;this._bulletManagers.forEach(function(e){e.forEach(function(e){t._resolveBullet(e,i),i++})}),e.vertexLength=4*o,e.primitiveLength=2*o,this._segments=[e]},e.prototype._createGLBufferGroup=function(){var t=[];return t.push({name:"a_pos",type:"FLOAT",components:3,offset:0}),t.push({name:"a_infos",type:"FLOAT",components:1,offset:12}),t.push({name:"a_color",type:"UNSIGNED_BYTE",components:4,offset:16}),{vertexLayoutArrayBuffer:new N(this._gl,this._vertexArray,"ARRAY_BUFFER",20,t),elementArrayBuffer:new N(this._gl,this._elementArray.buffer,"ELEMENT_ARRAY_BUFFER",6,[{components:3,name:"vertices",offset:0,type:"UNSIGNED_SHORT"}]),paintVertexArrayBuffer:null,segments:this._segments}},e.prototype._resolveBullet=function(t,e){var o=e;e*=4,this._resolveVeretx(t,e,0,1),this._resolveVeretx(t,e+1,1,1),this._resolveVeretx(t,e+2,1,0),this._resolveVeretx(t,e+3,0,0);var i=6*o;this._elementArray[i++]=e,this._elementArray[i++]=e+1,this._elementArray[i++]=e+2,this._elementArray[i++]=e,this._elementArray[i++]=e+2,this._elementArray[i++]=e+3},e.prototype._resolveVeretx=function(t,e,o,i){var r=e*this._vertexBufferByteSize/4,n=e*this._vertexBufferByteSize,s=t.loc.x,a=t.loc.y,u=t.loc.z,c=t.color,f=t.size;this.float32VertexArray[r]=s,this.float32VertexArray[r+1]=a,this.float32VertexArray[r+2]=u;var h=2*(2*f+o)+i;this.float32VertexArray[r+3]=h,this.uint8VertexArray[n+16]=c[0],this.uint8VertexArray[n+17]=c[1],this.uint8VertexArray[n+18]=c[2],this.uint8VertexArray[n+19]=c[3]},e}(z),rt=0;var nt,st=function(){function t(t){this._hateElement=t.hate}return t.prototype.update=function(){this._ai.update()},t.prototype.destroy=function(){this._ai.destroy(),this._me.destroy()},t}(),at=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();!function(t){t[t.Wait=0]="Wait",t[t.Search=1]="Search",t[t.Attack=2]="Attack"}(nt||(nt={}));var ut,ct=function(t){function e(){var e=t.call(this)||this;return e._actionMode=nt.Wait,e}return at(e,t),Object.defineProperty(e.prototype,"myObj",{set:function(t){this._myObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetObj",{set:function(t){this._targetObj=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionMode",{set:function(t){this._actionMode=t},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._myObj=null,this._targetObj=null,t.prototype.destroy.call(this)},e}(n),ft=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();!function(t){t.ChangeSpeed="cs",t.Fire="f",t.EndFire="ef"}(ut||(ut={}));var ht=function(t){function e(e){var o=t.call(this)||this;return o._attackToleranceDistance=400,o._searchToleranceDistance=600,o._attackMaxDistance=200,o}return ft(e,t),e.prototype.update=function(){var t=this._myObj.loc.clone().sub(this._targetObj.loc).mag();t>=600?this._startWait():t>=400?this._startSearch():this._startAttack(t)},e.prototype._startSearch=function(){this.emit(new p(ut.EndFire));var t=this._targetObj.loc.clone().sub(this._myObj.loc);this.emit(new p(ut.ChangeSpeed,t.unit().mult(.003)))},e.prototype._startWait=function(){this.emit(new p(ut.EndFire)),this._randomMove()},e.prototype._randomMove=function(){var t=this;this._waitVector?this.emit(new p(ut.ChangeSpeed,this._waitVector)):(this._waitVector=new i(Math.random()-.5,Math.random()-.5,0).unit().mult(.003),setTimeout(function(){t._waitVector=null},2e3))},e.prototype._startAttack=function(t){var e=this._targetObj.loc.clone().sub(this._myObj.loc);t>=200?this._randomMove():this.emit(new p(ut.ChangeSpeed,e.clone().unit().reverse().mult(.003))),this.emit(new p(ut.Fire,e))},e}(ct),At=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),lt=function(t){function e(e){var o=t.call(this,e)||this;return o._maxFirePerSec=1,o._bulletColor=[255,99,71,255],o._bulletSize=8,o._camp=1,o._bulletSpeed=.06,o._selfColor=[255,250,205,255],o._onFire=!1,o}return At(e,t),e.prototype.createTrashFish=function(t){var e;return this._me=new L({loc:t,uid:(e="Enemy_"+rt,rt++,e),camp:this._camp,lifePoint:10}),this._me.maxFirePerSec=this._maxFirePerSec,this._me.bulletColor=this._bulletColor,this._me.bulletSize=this._bulletSize,this._me.bulletSpeed=this._bulletSpeed,this._me.color=this._selfColor,this._initAi(),this._me},Object.defineProperty(e.prototype,"trashFish",{get:function(){return this._me},enumerable:!0,configurable:!0}),e.prototype._initAi=function(){this._ai=new ht({}),this._ai.myObj=this._me,this._ai.targetObj=this._hateElement,this._initEvent()},e.prototype._initEvent=function(){var t=this;this._ai.on(ut.ChangeSpeed,function(e){t._me.speed.add(e.data)}),this._ai.on(ut.Fire,function(e){t._me.direction=e.data.unit(),t._onFire||(t._onFire=t._me.startFire())}),this._ai.on(ut.EndFire,function(){t._onFire=!1,t._me.endFire()})},e}(st),_t=function(){function t(t,e){this.gl=null,this.texture=null,this.wrap=null,this.filter=null,this.format=null,this.format=t,this._premultiply=e}return t.prototype.destroy=function(t){t=t||this.gl,this.texture&&t&&(this.filter=null,this.wrap=null,t.deleteTexture(this.texture),this.texture=null)},t.prototype.prepareTexParam=function(t,e,o){e!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),this.filter=e),o!==this.wrap&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o),this.wrap=o)},t.prototype._preparePixelStore=function(t){"ALPHA"===this.format?t.pixelStorei(t.UNPACK_ALIGNMENT,1):t.pixelStorei(t.UNPACK_ALIGNMENT,4),this._premultiply?t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0):t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)},t.prototype._textureImage2D=function(t,e,o,i,r,n,s,a,u,c){c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData?t.texImage2D(e,o,t[i],t[a],u,c):t.texImage2D(e,o,t[i],r,n,s,t[a],u,c.data)},t}(),pt=o(2),Kt=o.n(pt),yt=o(3),gt=o.n(yt),dt=o(4),mt=o.n(dt),bt=o(5),vt=o.n(bt),xt=o(6),Ct=o.n(xt),wt=o(7),Et=o.n(wt),Ot=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Pt=function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{u(i.next(t))}catch(t){n(t)}}function a(t){try{u(i.throw(t))}catch(t){n(t)}}function u(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})},Tt=function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},Bt={positive_x:gt.a,negative_x:Kt.a,positive_y:vt.a,negative_y:mt.a,positive_z:Et.a,negative_z:Ct.a},Mt=null;function Lt(){return Pt(this,void 0,void 0,function(){var t,e,o,i,r;return Tt(this,function(n){switch(n.label){case 0:if(Mt)return[2,Mt];for(t=Object.keys(Bt),e={positive_x:null,positive_y:null,positive_z:null,negative_x:null,negative_y:null,negative_z:null},o=[],i=function(i){var r=t[i],n=function(t){return new Promise(function(e,o){var i=new Image;i.src=t,i.onload=function(){e(i)},i.onerror=function(t){o(t)}})}(Bt[r]);n.then(function(t){e[r]=t}),o.push(n)},r=0;r<t.length;r++)i(r);return[4,Promise.all(o)];case 1:return n.sent(),[2,Mt=new Ut(e,"RGBA",!1)]}})})}var Ut=function(t){function e(e,o,i){var r=t.call(this,o,i)||this;return r.update(e),r}return Ot(e,t),e.prototype.update=function(t){this.filter=null,this.wrap=null,this.imageBox=t},e.prototype.upload=function(t){var e=this;this.texture||(this.texture=t.createTexture()),this.gl=t;this.format;var o=this.imageBox;if(o){var i={positive_x:t.TEXTURE_CUBE_MAP_POSITIVE_X,negative_x:t.TEXTURE_CUBE_MAP_NEGATIVE_X,positive_y:t.TEXTURE_CUBE_MAP_POSITIVE_Y,negative_y:t.TEXTURE_CUBE_MAP_NEGATIVE_Y,positive_z:t.TEXTURE_CUBE_MAP_POSITIVE_Z,negative_z:t.TEXTURE_CUBE_MAP_NEGATIVE_Z};try{t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture),Object.keys(o).forEach(function(r){var n=o[r],s=i[r],a=n.width,u=n.height,c=t.UNSIGNED_BYTE,f=e.format;console.log(n,a,u),t.bindTexture(t.TEXTURE_CUBE_MAP,e.texture),e._textureImage2D(t,s,0,f,a,u,0,f,c,n)}),t.generateMipmap(t.TEXTURE_CUBE_MAP),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),this.imageBox=null}catch(t){console.error("image upload error",t)}}},e.prototype.bind=function(t,e,o){this.texture&&t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(_t),Vt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),St=function(t){function e(e){var o=t.call(this,e)||this;return o._programType="skybox",o._vertexBufferByteSize=4,o._initProgram(),o._loadPromise=Lt().then(function(t){o._texture=t,console.log(t)}),o}return Vt(e,t),e.prototype.update=function(){this._texture.upload(this._gl),this._program.bindUniform(this._gl,"u_sky_cube",0),this._texture.bind(this._gl,this._gl.LINEAR,this._gl.REPEAT),this._gl.activeTexture(this._gl.TEXTURE0),this._updateVertexBuffer()},e.prototype._createGLBufferGroup=function(){var t=[];return t.push({name:"a_pos",type:"SHORT",components:2,offset:0}),{vertexLayoutArrayBuffer:new N(this._gl,this._vertexArray,"ARRAY_BUFFER",this._vertexBufferByteSize,t),elementArrayBuffer:new N(this._gl,this._elementArray.buffer,"ELEMENT_ARRAY_BUFFER",6,[{components:3,name:"vertices",offset:0,type:"UNSIGNED_SHORT"}]),paintVertexArrayBuffer:null,segments:this._segments}},e.prototype._updateVertexBuffer=function(){this._vertexArray=new Int16Array([-1,1,1,1,-1,-1,1,-1]).buffer,this._elementArray=new Uint16Array([0,1,2,3,1,2]);var t=this._createSegment();t.vertexLength=4,t.primitiveLength=2,this._segments=[t]},e}(z),jt=function(t,e,o,i){return new(o||(o=Promise))(function(r,n){function s(t){try{u(i.next(t))}catch(t){n(t)}}function a(t){try{u(i.throw(t))}catch(t){n(t)}}function u(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(s,a)}u((i=i.apply(t,e||[])).next())})},It=function(t,e){var o,i,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],i=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},Ft=function(){function t(t,e,o){this._gridSize=50,this._trashFishs=[],this._width=t,this._height=e,this._dataBucket=new R,this._shooterLayer=new Q(o),this._bulletLayer=new it(o),this._gridLayer=new $(o),this._skyBoxLayer=new St(o),this._border=new q(t,e,this._gridSize),this._collisonManager=new w,this._initGrids()}return t.prototype.update=function(){this._trashFishs.forEach(function(t){t.update()}),this._shooterLayer.shooters.forEach(function(t){t.destroyed||t.update()})},t.prototype.globalCollsion=function(){var t=this;this._collisonManager.clear(),this._border.addCollsionUnit(this._collisonManager),this._shooterLayer.shooters.forEach(function(e){e.destroyed||e.addCollsionUnit(t._collisonManager)})},t.prototype.joinPlayer=function(t){var e=t.createShooter(new i(0,0,0));this._shooterLayer.addShooter(e),this._bulletLayer.addBulletManager(e),this._initEnemy(e)},t.prototype.setView=function(t){this._camera=t.camera,t.fitCamera()},t.prototype.prepareLayers=function(){return jt(this,void 0,void 0,function(){return It(this,function(t){switch(t.label){case 0:return this._skyBoxLayer.loadPromise?[4,this._skyBoxLayer.loadPromise]:[3,2];case 1:t.sent(),this._skyBoxLayer.loadPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.draw=function(){return jt(this,void 0,void 0,function(){return It(this,function(t){switch(t.label){case 0:return[4,this.prepareLayers()];case 1:return t.sent(),this.update(),this.globalCollsion(),this._skyBoxLayer.draw(this._camera.vpInverseMatrix),this._gridLayer.draw(this._camera.mvpMatrix),this._shooterLayer.draw(this._camera.mvpMatrix),this._bulletLayer.draw(this._camera.mvpMatrix),[2]}})})},t.prototype._initEnemy=function(t){for(var e=0;e<200;e++){var o=new lt({hate:t}),r=new i(Math.random()-.5,Math.random()-.5,0),n=o.createTrashFish(r.mult(1500));this._shooterLayer.addShooter(n),this._bulletLayer.addBulletManager(n),this._trashFishs.push(o)}},t.prototype._initGrids=function(){for(var t=0;t<this._width;t++)for(var e=0;e<this._height;e++){var o=t-Math.floor(this._width/2),i=e-Math.floor(this._height/2),r=new k(new et(o,i,0),this._gridSize,[0,0,0,100]);this._gridLayer.addGrid(r)}},t}(),Dt=o(8),Rt=o.n(Dt),kt=o(9),Nt=o.n(kt),zt=o(10),Gt=o.n(zt),Qt=o(11),Wt=o.n(Qt),Ht=o(12),Yt=o.n(Ht),Xt=o(13),Zt=o.n(Xt),qt={},Jt={};function $t(t,e){qt[t]=e}$t("triangle_vertexSource",Rt.a),$t("triangle_fragmentSource",Nt.a),$t("circle_vertexSource",Gt.a),$t("circle_fragmentSource",Wt.a),$t("skybox_vertexSource",Yt.a),$t("skybox_fragmentSource",Zt.a);var te="mediump",ee=function(){function t(t,e,o,i){e=this._processIncludes(e),o=this._processIncludes(o),this._defines=i,e=(i?i+"\n":"")+e,o=(i?i+"\n":"")+o,this._vertexSource=e.replace(/{precision}/,te),this._fragmentSource=o.replace(/{precision}/,te);var r=t.createShader(t.FRAGMENT_SHADER),n=t.createShader(t.VERTEX_SHADER);this.initVertexShader(t,n),this.initFragmentShader(t,r)}return t.prototype.attach=function(t,e){t.attachShader(e,this._vertexShader),t.attachShader(e,this._fragmentShader)},t.prototype._processIncludes=function(t){for(var e=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=e.exec(t),i=t;null!==o;){var r=o[1];if(Jt[r]){var n=Jt[r];i=i.replace(o[0],n)}else i=i.replace(o[0],""),console.warn("#inclue<"+r+"> not found in include store !");o=e.exec(t)}return i},t.prototype.initVertexShader=function(t,e){if(t.shaderSource(e,this._vertexSource),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(e));this._vertexShader=e},t.prototype.initFragmentShader=function(t,e){if(t.shaderSource(e,this._fragmentSource),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error("shader compile error: "+t.getShaderInfoLog(e));this._fragmentShader=e},Object.defineProperty(t.prototype,"vs",{get:function(){return this._vertexSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fs",{get:function(){return this._fragmentSource},enumerable:!0,configurable:!0}),t}(),oe=function(){function t(t,e,o,i,r){this._uniformActiveInfosMap=null,this._lastUniformMap={},this._warningMessagMap=null,this._frames=0,this._lastCoordZoom=-1,this._lastFrameId=-1,this._typeUniformFunMap={},this._coordMatrixLocMap={},this._matrixNameCoordMap={},this._matrixArrayLength=0,this._id=null,this._type=e,this._id=e+"_"+r,this._warningMessagMap={},this._program=t.createProgram(),this._ext=t.getExtension("OES_vertex_array_object"),this._boundElementBuffer=null,this._boundPaintVertexArrayBuffer=null,this._boundLayoutVertexBuffer=null,this._attributesLocation={};var n=new ee(t,o,i,r);this._attachLink(t,n),this._initAttributesLocation(t),this._updateActiveUniformInfos(t),this._uniformActiveInfosMap["u_matrix_array[0]"]&&(this._matrixArrayLength=this._uniformActiveInfosMap["u_matrix_array[0]"].size,this._updateMatrixUniformInfos(t)),this._prepareTypeUniformFunMap(t)}return Object.defineProperty(t.prototype,"lastLayerName",{get:function(){return this._lastLayerName},set:function(t){this._lastLayerName=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastFrameId",{get:function(){return this._lastFrameId},set:function(t){this._lastFrameId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastCoordZoom",{get:function(){return this._lastCoordZoom},set:function(t){this._lastCoordZoom=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frames",{get:function(){return this._frames},set:function(t){this._frames=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t.prototype.updateFrame=function(t){this._lastFrameId!==t&&(this._lastFrameId=t,this.clearFrame())},t.prototype.use=function(t){t.useProgram(this._program)},t.prototype.bindVAO=function(t,e,o){var i=(o.vaos||(o.vaos={}))[this._id];this._ext&&i?this._ext.bindVertexArrayOES(i):this.freshBindVAO(t,e,o)},t.prototype.bindUniformMatrix=function(t,e,o,i){if(void 0===i&&(i="u_coord_id"),void 0===this._coordMatrixLocMap[e]){var r=this._getFreeMatrixUniformIndex();void 0!==r?this.storeMatrixAt(t,r,o,e,i):this.bindNoCachedMatrix(t,o,i)}else this.bindUniform(t,i,this._coordMatrixLocMap[e])},t.prototype.storeMatrixAt=function(t,e,o,i,r){var n=this._uniformActiveInfosMap["u_matrix_array["+e+"]"];this._coordMatrixLocMap[i]=e,this._matrixNameCoordMap[e]=i,this.bindUniform(t,n.name,o),this.bindUniform(t,r,e)},t.prototype.bindNoCachedMatrix=function(t,e,o){void 0===o&&(o="u_coord_id");var i=this._matrixArrayLength-1;this.bindUniform(t,"u_matrix_array["+i+"]",e),this.bindUniform(t,o,i)},t.prototype.getAttributesLoaction=function(){return this._attributesLocation},t.prototype.clearFrame=function(){this._coordMatrixLocMap={},this._matrixNameCoordMap={}},t.prototype._getFreeMatrixUniformIndex=function(){for(var t=0;t<this._matrixArrayLength-1;t++)if(void 0===this._matrixNameCoordMap[t])return t},t.prototype._prepareTypeUniformFunMap=function(t){this._typeUniformFunMap[t.FLOAT]=t.uniform1f.bind(t),this._typeUniformFunMap[t.FLOAT+"_ARRAY"]=t.uniform1fv.bind(t),this._typeUniformFunMap[t.FLOAT_VEC2]=t.uniform2fv.bind(t),this._typeUniformFunMap[t.FLOAT_VEC3]=t.uniform3fv.bind(t),this._typeUniformFunMap[t.FLOAT_VEC4]=t.uniform4fv.bind(t),this._typeUniformFunMap[t.FLOAT_MAT2]=function(e,o){return t.uniformMatrix2fv(e,!1,o)},this._typeUniformFunMap[t.FLOAT_MAT3]=function(e,o){return t.uniformMatrix3fv(e,!1,o)},this._typeUniformFunMap[t.FLOAT_MAT4]=function(e,o){return t.uniformMatrix4fv(e,!1,o)},this._typeUniformFunMap[t.INT]=t.uniform1i.bind(t),this._typeUniformFunMap[t.INT+"_ARRAY"]=t.uniform1iv.bind(t),this._typeUniformFunMap[t.INT_VEC2]=t.uniform2iv.bind(t),this._typeUniformFunMap[t.INT_VEC3]=t.uniform3iv.bind(t),this._typeUniformFunMap[t.INT_VEC4]=t.uniform4iv.bind(t),this._typeUniformFunMap[t.BOOL]=t.uniform1i.bind(t),this._typeUniformFunMap[t.BOOL+"_ARRAY"]=t.uniform1iv.bind(t),this._typeUniformFunMap[t.BOOL_VEC2]=t.uniform2iv.bind(t),this._typeUniformFunMap[t.BOOL_VEC3]=t.uniform3iv.bind(t),this._typeUniformFunMap[t.BOOL_VEC4]=t.uniform4iv.bind(t),this._typeUniformFunMap[t.SAMPLER_2D]=t.uniform1i.bind(t),this._typeUniformFunMap[t.SAMPLER_CUBE]=t.uniform1i.bind(t)},t.prototype._attachLink=function(t,e){if(e.attach(t,this._program),t.linkProgram(this._program),!t.getProgramParameter(this._program,t.LINK_STATUS))throw new Error("program link error: "+t.getProgramInfoLog(this._program));this._shader=e},t.prototype._updateActiveUniformInfos=function(t){this._uniformActiveInfosMap={};for(var e=t.getProgramParameter(this._program,t.ACTIVE_UNIFORMS),o=0;o<e;o++){var i=t.getActiveUniform(this._program,o),r=t.getUniformLocation(this._program,i.name);i.loc=r,this._uniformActiveInfosMap[i.name]=i}},t.prototype._updateMatrixUniformInfos=function(t){for(var e=this._uniformActiveInfosMap["u_matrix_array[0]"],o=0;o<this._matrixArrayLength;o++){var i={name:"u_matrix_array["+o+"]",type:e.type,size:1},r=t.getUniformLocation(this._program,i.name);i.loc=r,this._uniformActiveInfosMap[i.name]=i}},t.prototype._initAttributesLocation=function(t){for(var e=t.getProgramParameter(this._program,t.ACTIVE_ATTRIBUTES),o=0;o<e;o++){var i=t.getActiveAttrib(this._program,o),r=t.getAttribLocation(this._program,i.name);this._attributesLocation[i.name]=r}},t.prototype._isBoundBuffersDiff=function(t,e){return!this._vertexArrayObject||this._boundElementBuffer!==t.elementArrayBuffer||this._boundPaintVertexArrayBuffer!==t.paintVertexArrayBuffer||this._boundLayoutVertexBuffer!==t.vertexLayoutArrayBuffer||this._boundVertexOffset!==e.vertexOffset},t.prototype._destroyVAO=function(t){this._ext.deleteVertexArrayOES(t),t=null},t.prototype._enableBufferAttributes=function(t,e){if(e&&e.attributes)for(var o=0,i=e.attributes;o<i.length;o++){var r=i[o],n=r.name;if(void 0!==this._attributesLocation[n]){var s=this._attributesLocation[n];r.disabled?t.disableVertexAttribArray(s):t.enableVertexAttribArray(s)}}},t.prototype._vertexAttribPointer=function(t,e){for(var o=0,i=e.attributes;o<i.length;o++){var r=i[o];if(void 0!==this._attributesLocation[r.name]){var n=this._attributesLocation[r.name];r.disabled||t.vertexAttribPointer(n,r.components,t[r.type],!1,e.elementBytes,r.offset+(e.elementBytes*this._boundVertexOffset||0))}}},t.prototype.freshBindVAO=function(t,e,o){if(this._boundElementBuffer=e.elementArrayBuffer,this._boundPaintVertexArrayBuffer=e.paintVertexArrayBuffer,this._boundLayoutVertexBuffer=e.vertexLayoutArrayBuffer,this._boundVertexOffset=o.vertexOffset,this._boundDynamicVertexArrayBuffer=e.dynamicVertexArrayBuffer,this._boundDynamicVertexArrayBuffer2=e.dynamicVertexArrayBuffer2,this._ext){var i=o.vaos||(o.vaos={}),r=i[this._id];r&&this._destroyVAO(r),r=i[this._id]=this._ext.createVertexArrayOES(),this._ext.bindVertexArrayOES(r),o.ext=this._ext}else for(var n in this._attributesLocation)t.disableVertexAttribArray(this._attributesLocation[n]);this._enableBufferAttributes(t,this._boundLayoutVertexBuffer),this._boundLayoutVertexBuffer.bind(),this._vertexAttribPointer(t,this._boundLayoutVertexBuffer),this._boundPaintVertexArrayBuffer&&(this._enableBufferAttributes(t,this._boundPaintVertexArrayBuffer),this._boundPaintVertexArrayBuffer.bind(),this._vertexAttribPointer(t,this._boundPaintVertexArrayBuffer)),this._boundDynamicVertexArrayBuffer&&this._boundDynamicVertexArrayBuffer.arrayBuffer&&this._boundDynamicVertexArrayBuffer.arrayBuffer.byteLength>0&&(this._enableBufferAttributes(t,this._boundDynamicVertexArrayBuffer),this._boundDynamicVertexArrayBuffer.bind(),this._vertexAttribPointer(t,this._boundDynamicVertexArrayBuffer)),this._boundDynamicVertexArrayBuffer2&&this._boundDynamicVertexArrayBuffer2.arrayBuffer&&this._boundDynamicVertexArrayBuffer2.arrayBuffer.byteLength>0&&(this._enableBufferAttributes(t,this._boundDynamicVertexArrayBuffer2),this._boundDynamicVertexArrayBuffer2.bind(),this._vertexAttribPointer(t,this._boundDynamicVertexArrayBuffer2)),this._boundElementBuffer&&this._boundElementBuffer.bind()},t.prototype.bindUniform=function(t,e,o,i){void 0===i&&(i=!1);var r=this._uniformActiveInfosMap[e];if(r){if(this._lastUniformMap[e]!==o||i){var n,s=r.type,a=r.loc;n||(n=this._typeUniformFunMap[s]),n&&n(a,o),this._lastUniformMap[e]=o}}else;},t.prototype.draw=function(t,e){t.drawElements(t.TRIANGLES,3*e.primitiveLength,t.UNSIGNED_SHORT,3*e.primitiveOffset*2)},t.prototype.drawGLLine=function(t,e){t.drawElements(t.LINES,2*e.primitiveLength,t.UNSIGNED_SHORT,2*e.primitiveOffset*2)},t.prototype.drawPoint=function(t,e){t.drawElements(t.POINTS,e.primitiveLength,t.UNSIGNED_SHORT,1*e.primitiveOffset*2)},t}(),ie=function(){function t(t,e){this._programCache={},this._initGL(t),this._dataBucket=e}return Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),t.prototype.useProgram=function(t){t&&this._currentProgram!==t&&(this._currentProgram=t,t.use(this._gl))},t.prototype.getCachedProgram=function(t){return this._programCache[t]},t.prototype.createProgram=function(t,e){var o=e?t+e:t;if(!this._programCache[o]){var i=qt[t+"_vertexSource"],r=qt[t+"_fragmentSource"];i&&r&&(this._programCache[o]=new oe(this._gl,t,i,r,e))}return this._programCache[o]},t.prototype.clearColor=function(t){this._gl.clearColor(t[0]/255,t[1]/255,t[2]/255,t[3]/255),this._gl.clear(this._gl.COLOR_BUFFER_BIT)},t.prototype._initGL=function(t){var e={alpha:!0,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,stencil:!0};this._gl=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),this._gl.getExtension("OES_standard_derivatives")||console.warn("OES_standard_derivatives not supported")},t}(),re=function(){function t(t){return new Float64Array(t)}return t.create=function(){return new t(3)},t.fromValues=function(e,o,i){void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0);var r=new t(3);return r[0]=e,r[1]=o,r[2]=i,r},t.normalize=function(t,e){var o=e[0],i=e[1],r=e[2],n=o*o+i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t},t.cross=function(e,o,i){return(e=e||t.create())[0]=o[1]*i[2]-o[2]*i[1],e[1]=o[2]*i[0]-o[0]*i[2],e[2]=o[0]*i[1]-o[1]*i[0],e},t.sub=function(e,o,i){return(e=e||t.create())[0]=o[0]-i[0],e[1]=o[1]-i[1],e[2]=o[2]-i[2],e},t}(),ne=function(){function t(t){return new Float64Array(t)}return t.create=function(){var e=new t(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.scale=function(t,e,o){var i=o[0],r=o[1],n=o[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.lookAt=function(e,o,i,r){e=e||t.create();var n=re.normalize(re.create(),re.sub(re.create(),o,i)),s=re.normalize(re.create(),re.cross(re.create(),r,n)),a=re.normalize(re.create(),re.cross(re.create(),n,s));return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=0,e[4]=a[0],e[5]=a[1],e[6]=a[2],e[7]=0,e[8]=n[0],e[9]=n[1],e[10]=n[2],e[11]=0,e[12]=o[0],e[13]=o[1],e[14]=o[2],e[15]=1,e},t.multiply=function(t,e,o){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],c=e[6],f=e[7],h=e[8],A=e[9],l=e[10],_=e[11],p=e[12],K=e[13],y=e[14],g=e[15],d=o[0],m=o[1],b=o[2],v=o[3];return t[0]=d*i+m*a+b*h+v*p,t[1]=d*r+m*u+b*A+v*K,t[2]=d*n+m*c+b*l+v*y,t[3]=d*s+m*f+b*_+v*g,d=o[4],m=o[5],b=o[6],v=o[7],t[4]=d*i+m*a+b*h+v*p,t[5]=d*r+m*u+b*A+v*K,t[6]=d*n+m*c+b*l+v*y,t[7]=d*s+m*f+b*_+v*g,d=o[8],m=o[9],b=o[10],v=o[11],t[8]=d*i+m*a+b*h+v*p,t[9]=d*r+m*u+b*A+v*K,t[10]=d*n+m*c+b*l+v*y,t[11]=d*s+m*f+b*_+v*g,d=o[12],m=o[13],b=o[14],v=o[15],t[12]=d*i+m*a+b*h+v*p,t[13]=d*r+m*u+b*A+v*K,t[14]=d*n+m*c+b*l+v*y,t[15]=d*s+m*f+b*_+v*g,t},t.translate=function(t,e,o){var i,r,n,s,a,u,c,f,h,A,l,_,p=o[0],K=o[1],y=o[2];return e===t?(t[12]=e[0]*p+e[4]*K+e[8]*y+e[12],t[13]=e[1]*p+e[5]*K+e[9]*y+e[13],t[14]=e[2]*p+e[6]*K+e[10]*y+e[14],t[15]=e[3]*p+e[7]*K+e[11]*y+e[15]):(i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],u=e[5],c=e[6],f=e[7],h=e[8],A=e[9],l=e[10],_=e[11],t[0]=i,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=u,t[6]=c,t[7]=f,t[8]=h,t[9]=A,t[10]=l,t[11]=_,t[12]=i*p+a*K+h*y+e[12],t[13]=r*p+u*K+A*y+e[13],t[14]=n*p+c*K+l*y+e[14],t[15]=s*p+f*K+_*y+e[15]),t},t.rotateX=function(t,e,o){var i=Math.sin(o),r=Math.cos(o),n=e[4],s=e[5],a=e[6],u=e[7],c=e[8],f=e[9],h=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+c*i,t[5]=s*r+f*i,t[6]=a*r+h*i,t[7]=u*r+A*i,t[8]=c*r-n*i,t[9]=f*r-s*i,t[10]=h*r-a*i,t[11]=A*r-u*i,t},t.rotateZ=function(t,e,o){var i=Math.sin(o),r=Math.cos(o),n=e[0],s=e[1],a=e[2],u=e[3],c=e[4],f=e[5],h=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+c*i,t[1]=s*r+f*i,t[2]=a*r+h*i,t[3]=u*r+A*i,t[4]=c*r-n*i,t[5]=f*r-s*i,t[6]=h*r-a*i,t[7]=A*r-u*i,t},t.ortho=function(t,e,o,i,r,n,s){var a=1/(e-o),u=1/(i-r),c=1/(n-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+o)*a,t[13]=(r+i)*u,t[14]=(s+n)*c,t[15]=1,t},t.perspective=function(t,e,o,i,r){var n,s=1/Math.tan(e/2);return t[0]=s/o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(n=1/(i-r),t[10]=(r+i)*n,t[14]=2*r*i*n):(t[10]=-1,t[14]=-2*i),t},t.transpose=function(t,e){if(t===e){var o=e[1],i=e[2],r=e[3],n=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=o,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=r,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},t.invert=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],u=e[6],c=e[7],f=e[8],h=e[9],A=e[10],l=e[11],_=e[12],p=e[13],K=e[14],y=e[15],g=o*a-i*s,d=o*u-r*s,m=o*c-n*s,b=i*u-r*a,v=i*c-n*a,x=r*c-n*u,C=f*p-h*_,w=f*K-A*_,E=f*y-l*_,O=h*K-A*p,P=h*y-l*p,T=A*y-l*K,B=g*T-d*P+m*O+b*E-v*w+x*C;return B||(B=1/(2<<30)),B=1/B,t[0]=(a*T-u*P+c*O)*B,t[1]=(r*P-i*T-n*O)*B,t[2]=(p*x-K*v+y*b)*B,t[3]=(A*v-h*x-l*b)*B,t[4]=(u*E-s*T-c*w)*B,t[5]=(o*T-r*E+n*w)*B,t[6]=(K*m-_*x-y*d)*B,t[7]=(f*x-A*m+l*d)*B,t[8]=(s*P-a*E+c*C)*B,t[9]=(i*E-o*P-n*C)*B,t[10]=(_*v-p*m+y*g)*B,t[11]=(h*m-f*v-l*g)*B,t[12]=(a*w-s*O-u*C)*B,t[13]=(o*O-i*w+r*C)*B,t[14]=(p*d-_*b-K*g)*B,t[15]=(f*b-h*d+A*g)*B,t},t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t}(),se=function(){function t(t){return new Float64Array(t)}return t.create=function(){return new t(4)},t.fromValues=function(e,o,i,r){void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===r&&(r=1);var n=new t(4);return n[0]=e,n[1]=o,n[2]=i,n[3]=r,n},t.transformMat4=function(t,e,o){var i=e[0],r=e[1],n=e[2],s=e[3];return t[0]=o[0]*i+o[4]*r+o[8]*n+o[12]*s,t[1]=o[1]*i+o[5]*r+o[9]*n+o[13]*s,t[2]=o[2]*i+o[6]*r+o[10]*n+o[14]*s,t[3]=o[3]*i+o[7]*r+o[11]*n+o[15]*s,t},t}();Math.PI;var ae=function(){function t(t){this._loc=new i(0,0,0),this._fov=.4,this._currentPitch=0,this._currentAngle=0,this._scale=1,this._pixelHeight=t.canvas.offsetHeight,this._pixelWidth=t.canvas.offsetWidth,this.setLoc(new i(0,0,0))}return Object.defineProperty(t.prototype,"angle",{get:function(){return this._currentAngle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._currentPitch},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vpInverseMatrix",{get:function(){return this._directionVPInverseMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mvpMatrix",{get:function(){return this._mvpMatrix},enumerable:!0,configurable:!0}),t.prototype.setLoc=function(t){this._loc=t,this._updateMVPMatrix(),this._updatePixelMatrix()},t.prototype.setPitch=function(t){console.log(t),this._currentPitch=t,this._updateMVPMatrix(),this._updatePixelMatrix()},t.prototype.pixelToCoordinate=function(t){var e=se.create(),o=se.create();se.transformMat4(e,[t.x,t.y,0,1],this._pixelMatrixReverse),se.transformMat4(o,[t.x,t.y,1,1],this._pixelMatrixReverse);var r=(e[2]/e[3]*o[0]/o[3]-e[0]/e[3]*o[2]/o[3])/(e[2]/e[3]-o[2]/o[3]),n=(e[2]/e[3]*o[1]/o[3]-o[2]/o[3]*e[1]/e[3])/(e[2]/e[3]-o[2]/o[3]),s=new i(r,n,0),a=se.create();return se.transformMat4(a,[r,n,0,1],this._modelViewMatrix),a[2]>=0&&console.warn("The point are beyond the scope of the screen and the projection is incorrect."),s},t.prototype.setAngle=function(t){this._currentAngle=t,this._updateMVPMatrix(),this._updatePixelMatrix()},t.prototype._updateMVPMatrix=function(){this._pixelToWorldCenter=.5*this._pixelHeight/Math.tan(this._fov/2);this._currentPitch,Math.PI;var t=this._pixelToWorldCenter*Math.sin(this._fov/2)/Math.sin(Math.PI/2-this._fov/2-this._currentPitch);this._viewPixelDistance=1.01*(t*Math.cos(Math.PI/2-this._currentPitch)+this._pixelToWorldCenter);var e=this._pixelWidth/this._pixelHeight;this._modelViewMatrix=ne.create(),ne.scale(this._modelViewMatrix,this._modelViewMatrix,[1,-1,1]),ne.translate(this._modelViewMatrix,this._modelViewMatrix,[0,0,-this._pixelToWorldCenter]),ne.rotateX(this._modelViewMatrix,this._modelViewMatrix,this._currentPitch),ne.rotateZ(this._modelViewMatrix,this._modelViewMatrix,this._currentAngle),ne.translate(this._modelViewMatrix,this._modelViewMatrix,[-this._loc.x*this._scale,-this._loc.y*this._scale,0]),this._projMatrix=ne.create(),ne.perspective(this._projMatrix,this._fov,e,1,this._viewPixelDistance);var o=ne.create();ne.lookAt(o,[Math.cos(-this._currentAngle)*Math.sin(this._currentPitch),Math.cos(this._currentPitch),Math.sin(-this._currentAngle)*Math.sin(this._currentPitch)],[0,0,0],[0,1,0]),ne.invert(o,o),o[12]=0,o[13]=0,o[14]=0,ne.multiply(o,this._projMatrix,o),this._directionVPInverseMatrix=ne.invert(ne.create(),o),ne.scale(this._modelViewMatrix,this._modelViewMatrix,[1,1,this._scale,1]),this._mvpMatrix=ne.create(),ne.multiply(this._mvpMatrix,this._projMatrix,this._modelViewMatrix)},t.prototype._updatePixelMatrix=function(){var t=ne.create();if(ne.scale(t,t,[this._pixelWidth/2,-this._pixelHeight/2,1]),ne.translate(t,t,[1,-1,0]),ne.multiply(t,t,this._mvpMatrix),this._pixelMatrix=t,this._pixelMatrixReverse=ne.invert(ne.create(),this._pixelMatrix),!this._pixelMatrixReverse)throw new Error("Fail to reverse pixel matrix")},t}(),ue=function(){function t(){}return Object.defineProperty(t,"dpr",{get:function(){return t._dpr?t._dpr:(t._dpr=window.devicePixelRatio||1,t._dpr)},enumerable:!0,configurable:!0}),t}(),ce=function(){function t(t){this._canvas=t,this._resizeCanvas(t.offsetWidth,t.offsetHeight)}return Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),t.prototype._resizeCanvas=function(t,e){this.canvas.width=ue.dpr*t,this.canvas.height=ue.dpr*e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"},t}(),fe=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),he={};he[87]=new i(0,-1,0),he[65]=new i(-1,0,0),he[83]=new i(0,1,0),he[68]=new i(1,0,0);var Ae,le,_e=function(t){function e(e){var o=t.call(this)||this;return o._nowFrameEvent={},o.keyDown=o.keyDown.bind(o),o.keyUp=o.keyUp.bind(o),o._element=e,document.addEventListener("keydown",o.keyDown),document.addEventListener("keyup",o.keyUp),o._getNowFrameEvent(),o}return fe(e,t),e.prototype.keyDown=function(t){var e=t.keyCode;he[e]&&(this._nowFrameEvent[e]=he[e])},e.prototype.keyUp=function(t){t.keyCode;this._nowFrameEvent[t.keyCode]&&delete this._nowFrameEvent[t.keyCode]},e.prototype._getNowFrameEvent=function(){var t=this,e=function(){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){var o=new i(0,0,0);Object.keys(t._nowFrameEvent).forEach(function(e){o.add(t._nowFrameEvent[e])}),0!==o.mag()?(o.unit(),o.mult(.01),t.emit(new p("change_speed",o)),e()):e()})})};e()},e}(n),pe=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();!function(t){t[t.TOP_LEFT=1]="TOP_LEFT",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=4]="BOTTOM_RIGHT"}(Ae||(Ae={})),function(t){t.DOWN="BUTTONDOWN",t.UP="BUTTONUP"}(le||(le={})),document.body.addEventListener("touchmove",function(t){t.preventDefault(),t.stopPropagation()},{passive:!1});var Ke=function(t){function e(e){var o=t.call(this)||this,i=e.container,r=e.text,n=e.offset,s=e.size,a=e.position;return o._text=r,o._offset=n,o._size=s,o._container=i,o._position=a,o._init(),o}return pe(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._button=document.createElement("button");var t="px";this._button.textContent=this._text,this._button.style.width=this._size.x+t,this._button.style.height=this._size.y+t,this._button.style.position="absolute",this._button.style.userSelect="none",this._button.style.opacity="0.3",this._position===Ae.TOP_LEFT?(this._button.style.top=this._offset.y+t,this._button.style.left=this._offset.x+t):this._position===Ae.TOP_RIGHT?(this._button.style.top=this._offset.y+t,this._button.style.right=this._offset.x+t):this._position===Ae.BOTTOM_LEFT?(this._button.style.bottom=this._offset.y+t,this._button.style.left=this._offset.x+t):this._position===Ae.BOTTOM_RIGHT&&(this._button.style.bottom=this._offset.y+t,this._button.style.right=this._offset.x+t),this._container.appendChild(this._button),this._registEvent()},e.prototype._registEvent=function(){this._touchStart=this._touchStart.bind(this),this._touchEnd=this._touchEnd.bind(this),this._button.addEventListener("touchstart",this._touchStart),this._button.addEventListener("touchend",this._touchEnd),this._button.addEventListener("mousedown",this._touchStart),this._button.addEventListener("mouseup",this._touchEnd)},e.prototype._touchStart=function(t){t.stopPropagation(),this.emit(new p(le.DOWN,this))},e.prototype._touchEnd=function(t){t.stopPropagation(),this.emit(new p(le.UP,this))},e}(n),ye=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),ge={};ge.w=new i(0,-1,0),ge.a=new i(-1,0,0),ge.s=new i(0,1,0),ge.d=new i(1,0,0);var de=function(t){function e(e){var o=t.call(this)||this;return o._buttons=[],o._nowFrameEvent={},o._container=e,o._init(),o}return ye(e,t),e.prototype._init=function(){this._element=document.createElement("div"),this._element.style.height="100%",this._element.style.width="100%",this._element.style.position="absolute",this._container.appendChild(this._element),this._initButton(),this._registEvent(),this._getNowFrameEvent()},e.prototype._initButton=function(){var t=this,e=new i(20,20,0),o=new i(80,80,0);[{text:"a",offset:e,position:Ae.BOTTOM_LEFT},{text:"s",offset:e.clone().add(new i(o.x+5,0,0)),position:Ae.BOTTOM_LEFT},{text:"d",offset:e.clone().add(new i(2*o.x+10,0,0)),position:Ae.BOTTOM_LEFT},{text:"w",offset:e.clone().add(new i(o.x+5,o.y+5,0)),position:Ae.BOTTOM_LEFT}].forEach(function(e){var i=e.text,r=e.offset,n=e.position,s=new Ke({container:t._element,text:i,offset:r,position:n,size:o});t._buttons.push(s),s.setParent(t)})},e.prototype._registEvent=function(){this._onButtonUp=this._onButtonUp.bind(this),this._onButtonDown=this._onButtonDown.bind(this),this.on(le.DOWN,this._onButtonDown),this.on(le.UP,this._onButtonUp)},e.prototype._onButtonDown=function(t){var e=t.data.text;console.log(e),this._nowFrameEvent[e]=ge[e]},e.prototype._onButtonUp=function(t){var e=t.data.text;this._nowFrameEvent[e]&&delete this._nowFrameEvent[e]},e.prototype._getNowFrameEvent=function(){var t=this,e=function(){window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){var o=new i(0,0,0);Object.keys(t._nowFrameEvent).forEach(function(e){o.add(t._nowFrameEvent[e])}),0!==o.mag()?(o.unit(),o.mult(.01),t.emit(new p("change_speed",o)),e()):e()})})};e()},e}(n);o.d(e,"Game",function(){return be});var me=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),be=function(t){function e(){var e=t.call(this)||this,o=document.getElementById("gameContainer");e._container=o,e._uiElement=new de(e._container);var i=document.createElement("canvas");return o.appendChild(i),i.id="game",e._viewPort=new ce(i),e._renderer=new ie(i),e._scene=new Ft(30,30,e._renderer),e._canvas=i,e}return me(e,t),e.prototype.connectPlayer=function(){var t=new ae(this._viewPort),e=new _e(this._container),o=new F(this._container,t);this._player=new D({id:"shujingwei",secret:"sjwsjw",camera:t,keyboard:e,mouse:o,uiElement:this._uiElement}),this._scene.joinPlayer(this._player)},e.prototype.framePaint=function(){var t=this,e=function(){window.requestAnimationFrame(function(){t._scene.setView(t._player),t._renderer.clearColor([0,0,0,50]),t._scene.draw(),e()})};e()},e.prototype.start=function(){this.framePaint()},e}(n),ve=new be;ve.connectPlayer(),ve.start()}])});